# Todo

This is a preliminary list of things missing in psx (which is quite a bit...)

- [x] cop0
    - [x] Implement interrupt::free
    - [x] Enable coprocessors
- [ ] GTE
    - [ ] Add coprocessor 2 asm snippets
- [ ] GPU
    - [x] Graphics pipeline
        - [ ] Finish up methods for textured primitives
        - [x] Double buffering
            - [x] Think of a good way to swap all primitives at once. All primitives borrow Buffer so maybe checking a bool there might work
        - [x] Find a way to avoid rewriting `T`'s methods for `Packet<T>`. `Packet<T>` will save 32 bits per primitive so it's definitely the way to go, but I'd rather not have to write so many methods if possible
        - [x] Ordering table method names could be clearer
    - [x] Textures
        - [x] Basic support
        - [x] Finish textured primitives
    - [ ] Framebuffer
        - [ ] Variable video mode, interlacing and color depth
    - [x] Depth ordering tables
    - [ ] Timers
    - [ ] draw_quad with logical vertex ordering
    - [ ] VRAM to CPU via DMA
- [ ] MDEC
- [ ] SPU
- [ ] Interrupts
    - [ ] Fix ack for IRQ1..3, 7..10
    - [ ] Add relevant coprocessor 0 asm snippets
    - [ ] There seems to be a subtle bug with ack/wait Vblank since mednafen no longer works
- [ ] DMA
    - [x] Finish GPU channel
    - [x] Add other channels
    - [ ] Integrate with interrupts
- [ ] Timers
- [ ] CDROM/ISO
    - [ ] Via kernel
    - [ ] Via MMIO
- [ ] Controllers
- [ ] Memory cards
- [ ] BIOS
    - [ ] Threads
    - [ ] Try inlining bios asm trampolines
- [ ] allocator
    - [x] Test collections (use GNU ld for now)
        - [ ] Made use of Vec and Box in doom demo, but I should add some tests to the `psx` crate itself
    - [x] Fix linker error for `alloc` crate with rust-lld
- [ ] Printer
    - [x] Fix printer msg type to work with &str or similar
    - [ ] Fix font_size. Add option to use Sprt16
    - [ ] Keep trying to decrease size of font.tim.zip
    - [ ] Find a way to use Printer with small buffers
    - [ ] Consider something similar to typestates for load_font. But how do I know when someone overwrites the section of VRAM with the font? (i.e. Printer changes from FontLoaded to FontNotLoaded)
    - [ ] Add an UncheckedPrinter
- [ ] Pretty Panic
    - [x] Get formatted args working. Depends on String so it's kinda blocked until allocator is well-tested.
    - [x] Make printing panic messages a config option since it adds a whole 10 KB (even with LTO)
        - [x] cfg attributes worked, now how do I set a feature?
- [ ] Unzip
    - [ ] Making TIM take a mutable slice broke my lazy macros :( Fix this. Having TIM hold on to its data can work
    - [ ] Add tests (for x86-64) to verify that future commits don't break macros
        - [ ] There's a transmute that assumes usize == u32 that makes this difficult on x86-64, I'd like to avoid having a separate crate for tests but that might work
    - [ ] Streaming decompression
        - [ ] Design the GPU pipeline first to see if this fits in somewhere
- [x] TIM parser
    - [x] Test CLUTs
    - [x] Make DMA TIM loader non-blocking
    - [ ] Are CLUT-only TIMs a thing?
- [ ] Tests
    - [ ] Test macro invocations
    - [ ] I might've tried to get too fancy with IRQs, so I should test these
    - [ ] Test the gpu::graphics stuff
- [ ] Miscellaneous
    - [ ] Check if any `volatile_*` need a `compiler_fence` (see embedonomicon DMA chapter)

This is an incomplete list of things missing in `cargo-psx`

- [ ] Modify `extract_flag` and `extract_key_value` to take a `&mut Vec<String>` and only return the extracted result
- [ ] Wrap cargo-init to overwrite src/main.rs with program template
- [ ] Allow user-defined RUSTFLAGS env var
