# Todo

This is a preliminary list of things missing in psx (which is almost everything...)

- [ ] GPU
    - [x] Graphics pipeline
        - [ ] Finish up methods for textured primitives
        - [x] Double buffering
            - [x] Think of a good way to swap all primitives at once. All primitives borrow Buffer so maybe checking a bool there might work
        - [x] Find a way to avoid rewriting `T`'s methods for `Packet<T>`. `Packet<T>` will save 32 bits per primitive so it's definitely the way to go, but I'd rather not have to write so many methods if possible
        - [x] Ordering table method names could be clearer
    - [x] Textures
        - [x] Basic support
        - [x] Finish textured primitives
    - [ ] Framebuffer
        - [ ] Variable video mode, interlacing and color depth
    - [x] Depth ordering tables
    - [ ] Timers
    - [ ] draw_quad with logical vertex ordering
    - [ ] VRAM to CPU via DMA
- [ ] GTE
    - [ ] Add coprocessor 2 asm snippets
- [ ] MDEC
- [ ] SPU
- [ ] Interrupts
    - [ ] Fix ack for IRQ1..3, 7..10
    - [ ] Add relevant coprocessor 0 asm snippets
    - [ ] There seems to be a subtle bug with ack/wait Vblank since mednafen no longer works
- [ ] DMA
    - [x] Finish GPU channel
    - [x] Add other channels
    - [ ] Integrate with interrupts
- [ ] Timers
- [ ] CDROM/ISO
    - [ ] Via kernel
    - [ ] Via MMIO
- [ ] Controllers
- [ ] Memory cards
- [ ] BIOS
    - [ ] Threads
    - [ ] Try inlining bios asm trampolines
- [ ] allocator
    - [ ] Test collections (use GNU ld for now)
    - [ ] Fix linker error for `alloc` crate with rust-lld
- [ ] Printer
    - [x] Fix printer msg type to work with &str or similar
    - [ ] Add an UncheckedPrinter
- [ ] Pretty Panic
    - [ ] Get formatted args working. Depends on String so it's kinda blocked until allocator is well-tested.
    - [ ] Make printing panic messages a config option since it adds a whole 10 KB (even with LTO)
        - [ ] cfg attributes worked, now how do I set a feature?
- [ ] Unzip
    - [ ] Making TIM take a mutable slice broke my lazy macros :( Fix this. Having TIM hold on to its data can work
    - [ ] Add tests (for x86-64) to verify that future commits don't break macros
        - [ ] There's a transmute that assumes usize == u32 that makes this difficult on x86-64, I'd like to avoid having a separate crate for tests but that might work
    - [ ] Streaming decompression
        - [ ] Design the GPU pipeline first to see if this fits in somewhere
- [x] TIM parser
    - [x] Test CLUTs
    - [x] Make DMA TIM loader non-blocking
- [ ] Check if any `volatile_*` need a `compiler_fence` (see embedonomicon DMA chapter)
